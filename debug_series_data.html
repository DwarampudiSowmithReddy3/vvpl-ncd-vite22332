<!DOCTYPE html>
<html>
<head>
    <title>Debug Series Data</title>
</head>
<body>
    <h1>Debug Series Data</h1>
    <div id="results"></div>
    
    <script>
        async function debugSeriesData() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Debugging series data...</p>';
            
            try {
                // Login
                const loginResponse = await fetch('http://localhost:8003/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123',
                        user_type: 'admin'
                    })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    results.innerHTML += '<p>✅ Login successful</p>';
                    
                    // Get series
                    const seriesResponse = await fetch('http://localhost:8003/api/v1/series/', {
                        headers: { 'Authorization': `Bearer ${loginData.access_token}` }
                    });
                    
                    if (seriesResponse.ok) {
                        const seriesData = await seriesResponse.json();
                        results.innerHTML += `<p>✅ Raw data: ${seriesData.length} series</p>`;
                        
                        // Transform data like frontend does
                        const transformedSeries = seriesData.map(s => ({
                            id: s.id,
                            name: s.series_name,
                            seriesCode: s.series_code,
                            interestRate: s.interest_rate,
                            status: s.status,
                            targetAmount: s.targetAmount || s.issue_size,
                            fundsRaised: s.fundsRaised || s.total_subscribed || 0,
                            investors: s.investors || 0
                        }));
                        
                        results.innerHTML += `<p>✅ Transformed data: ${transformedSeries.length} series</p>`;
                        
                        transformedSeries.forEach((series, index) => {
                            results.innerHTML += `
                                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                                    <h3>${series.name} (${series.seriesCode})</h3>
                                    <p>Status: ${series.status}</p>
                                    <p>Interest Rate: ${series.interestRate}%</p>
                                    <p>Target: ₹${series.targetAmount?.toLocaleString()}</p>
                                    <p>Funds Raised: ₹${series.fundsRaised?.toLocaleString()}</p>
                                    <p>Investors: ${series.investors}</p>
                                </div>
                            `;
                        });
                    } else {
                        results.innerHTML += `<p>❌ Failed to fetch series: ${seriesResponse.status}</p>`;
                    }
                } else {
                    results.innerHTML += `<p>❌ Login failed: ${loginResponse.status}</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p>❌ Error: ${error.message}</p>`;
            }
        }
        
        debugSeriesData();
    </script>
</body>
</html>