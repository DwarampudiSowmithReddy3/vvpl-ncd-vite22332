<!DOCTYPE html>
<html>
<head>
    <title>Test Components</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #e3f2fd; border-color: #bbdefb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Component Testing</h1>
    
    <div class="test-section info">
        <h3>Step 1: Clear All Data</h3>
        <p>First, clear all localStorage data to start fresh</p>
        <button onclick="clearAllData()">Clear All Data</button>
        <div id="clear-status"></div>
    </div>

    <div class="test-section info">
        <h3>Step 2: Test App Loading</h3>
        <p>Load the main app in an iframe to check for errors</p>
        <button onclick="testAppLoading()">Test App Loading</button>
        <div id="app-status"></div>
        <div id="app-frame"></div>
    </div>

    <div class="test-section info">
        <h3>Step 3: Check Console Errors</h3>
        <p>Monitor browser console for JavaScript errors</p>
        <button onclick="checkConsoleErrors()">Check Console</button>
        <div id="console-status"></div>
    </div>

    <div class="test-section info">
        <h3>Step 4: Test Login</h3>
        <p>Test if login page loads and works</p>
        <button onclick="testLogin()">Test Login</button>
        <div id="login-status"></div>
    </div>

    <script>
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML = `<div class="test-section ${className}">${message}</div>`;
        }

        function clearAllData() {
            try {
                // Clear all possible localStorage keys
                const keysToRemove = [
                    'investors', 'series', 'complaints', 'auditLogs', 
                    'satisfactionEvents', 'complianceStatus', 
                    'payoutStatusUpdates', 'payoutMetadata', 
                    'dataVersion', 'user'
                ];
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                // Clear all localStorage
                localStorage.clear();
                
                updateStatus('clear-status', '‚úÖ All localStorage data cleared successfully', 'success');
                
            } catch (error) {
                updateStatus('clear-status', `‚ùå Error clearing data: ${error.message}`, 'error');
            }
        }

        function testAppLoading() {
            updateStatus('app-status', 'üîÑ Testing app loading...', 'info');
            
            try {
                const frameContainer = document.getElementById('app-frame');
                frameContainer.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.src = '/';
                
                let loadTimeout = setTimeout(() => {
                    updateStatus('app-status', '‚ö†Ô∏è App loading timeout (10 seconds)', 'error');
                }, 10000);
                
                iframe.onload = function() {
                    clearTimeout(loadTimeout);
                    updateStatus('app-status', '‚úÖ App loaded successfully in iframe', 'success');
                    
                    // Try to detect if it's a white page
                    setTimeout(() => {
                        try {
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            const bodyContent = iframeDoc.body.innerText.trim();
                            
                            if (bodyContent.length < 10) {
                                updateStatus('app-status', '‚ö†Ô∏è App loaded but appears to be blank (white page)', 'error');
                            } else {
                                updateStatus('app-status', '‚úÖ App loaded with content', 'success');
                            }
                        } catch (e) {
                            updateStatus('app-status', '‚úÖ App loaded (cross-origin, cannot check content)', 'success');
                        }
                    }, 2000);
                };
                
                iframe.onerror = function() {
                    clearTimeout(loadTimeout);
                    updateStatus('app-status', '‚ùå App failed to load', 'error');
                };
                
                frameContainer.appendChild(iframe);
                
            } catch (error) {
                updateStatus('app-status', `‚ùå Error testing app: ${error.message}`, 'error');
            }
        }

        function checkConsoleErrors() {
            updateStatus('console-status', 'üîç Monitoring console for 5 seconds...', 'info');
            
            const originalError = console.error;
            const originalWarn = console.warn;
            const errors = [];
            const warnings = [];
            
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };
            
            console.warn = function(...args) {
                warnings.push(args.join(' '));
                originalWarn.apply(console, args);
            };
            
            setTimeout(() => {
                console.error = originalError;
                console.warn = originalWarn;
                
                let message = '';
                if (errors.length > 0) {
                    message += `‚ùå ${errors.length} Console Errors: ${errors.join(', ')}<br>`;
                }
                if (warnings.length > 0) {
                    message += `‚ö†Ô∏è ${warnings.length} Console Warnings: ${warnings.join(', ')}<br>`;
                }
                if (errors.length === 0 && warnings.length === 0) {
                    message = '‚úÖ No console errors or warnings detected';
                }
                
                updateStatus('console-status', message, errors.length > 0 ? 'error' : 'success');
            }, 5000);
        }

        function testLogin() {
            updateStatus('login-status', 'üîÑ Testing login page...', 'info');
            
            try {
                // Test if we can navigate to login
                const testUrl = '/login';
                fetch(testUrl, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok || response.status === 404) {
                            updateStatus('login-status', '‚úÖ Login route accessible', 'success');
                        } else {
                            updateStatus('login-status', `‚ö†Ô∏è Login route returned status: ${response.status}`, 'error');
                        }
                    })
                    .catch(error => {
                        updateStatus('login-status', `‚ùå Error accessing login: ${error.message}`, 'error');
                    });
                
            } catch (error) {
                updateStatus('login-status', `‚ùå Error testing login: ${error.message}`, 'error');
            }
        }

        // Auto-run on page load
        window.onload = function() {
            console.log('üöÄ Component testing page loaded');
        };
    </script>
</body>
</html>